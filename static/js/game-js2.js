var startTimeImageExamination,startTimePage,finishTimeManual,data={},amountToChange=10,zoomInOutSpeed=100,countCompletedImages=0,countZoomIn=0,countZoomOut=0,results=[],automationDone=!1,numberOfCorrectManual=0,numberOfIncorrectManual=0;function shuffle(e){for(var t,a,n=e.length;n;t=parseInt(Math.random()*n),a=e[--n],e[n]=e[t],e[t]=a);return e}function sortNumber(e,t){return e-t}function populateImages(e,t,a){for(var n=[],o=[],i=1;i<=e+t;i++)o.push(i);o=shuffle(o),e>0&&$("#placeHolderNoManualImg").remove();for(var r=0;r<o.slice(0,e).length;r++)generateManualImage(o[r]);t>0&&$("#placeHolderNoAutoImg").remove();for(r=o.slice(0,e).length;r<o.length;r++)generateAutomationImage(o[r]),n.push(o[r]);ATD(n)}function generateManualImage(e){$("#manualImageTiles").append('<div class="col-lg-5ths col-md-3 col-sm-4 col-xs-6" id="imageTile'+e+'"><div class="hoverEffect blueBorder"><img id="img'+e+'"src='+static_url+"images/car"+e+'.jpg class="img-responsive" onclick="viewImage(this.id)"><p id="viewText'+e+'" ><a id="img'+e+'"class="label label-danger" rel="tooltip" title="View" onclick="viewImage(this.id)">View</a></p><h4 id="correctness'+e+'"></h4></div></div>')}function generateAutomationImage(e){$("#automationImageTiles").append('<div class="col-lg-5ths col-md-3 col-sm-4 col-xs-6" id="imageTile'+e+'"><div class="hoverEffect yellowBorder"><img src='+static_url+"images/car"+e+'.jpg class="img-responsive"><h4 id="correctness'+e+'"></h4><div id="overlay'+e+'" class="loading-overlay"></div></div></div>')}function ATD(e){var t=[],a=e.slice(0);t=(t=shuffle(a)).slice(0,numImgNotProcessed);var n=0,o=0,i=0;$.each(e,function(a,r){setTimeout(function(){a>0&&($("#loader"+e[a-1]).hide(),$("#imageTile"+e[a-1]).fadeTo("slow",.44),$("#correctness"+e[a-1]).css("display","block"),-1==jQuery.inArray(e[a-1],t)?($("#correctness"+e[a-1]).append('<i class="icon-ok-sign text-success"></i>'),n++):($("#correctness"+e[a-1]).append('<i class="icon-question text-info"></i>'),o++),i=Number(n)+Number(o),$("#autoAccScore").html("Accuracy: "+Number(n)+"/"+i),$("#autoAccScore").fadeTo(100,.1).fadeTo(200,1),$("#imageTile"+e[a-1]).append('<div class="disabledImageTile"></div>')),$("#overlay"+e[a]).html('<div id="loader'+e[a]+'" class="spin-loader"></div>'),a==e.length-1&&setTimeout(function(){($("#loader"+e[a]).hide(),$("#imageTile"+e[a]).fadeTo("slow",.44),$("#correctness"+e[a]).css("display","block"),$("#correctness"+e[a]).append('<i class="icon-ok-sign text-success"></i>'),n++,i++,$("#autoAccScore").html("Accuracy: "+Number(n)+"/"+i),$("#imageTile"+e[a]).append('<div class="disabledImageTile"></div>'),automationDone=!0,countCompletedImages==numImgToManual)&&sendData((new Date-startTimePage)/1e3)},4e3)},4e3*a)})}function zoomIn(){var e=$("#imageDiv").find("img");if(e.length>0){var t=e.first().attr("id"),a=($("#"+t).width(),$("#"+t).height());"block"===document.getElementById("alertMaxMinZoomLevel").style.display&&(document.getElementById("alertMaxMinZoomLevel").style.display="none"),a>=390?(document.getElementById("alertMaxMinZoomLevel").style.display="block",$("#alertMaxMinZoomLevel").html('<p class="text-danger"> Maximum zoom-in level was reached!</p>')):($("#"+t).animate({height:"+="+amountToChange+"px",width:"+="+amountToChange+"px"},{duration:zoomInOutSpeed}),countZoomIn++)}}function zoomOut(){var e=$("#imageDiv").find("img");if(e.length>0){var t=e.first().attr("id"),a=$("#"+t).width();$("#"+t).height();"block"===document.getElementById("alertMaxMinZoomLevel").style.display&&(document.getElementById("alertMaxMinZoomLevel").style.display="none"),a<=50?(document.getElementById("alertMaxMinZoomLevel").style.display="block",$("#alertMaxMinZoomLevel").html('<p class="text-danger"> Minimum zoom-out level was reached!</p>')):($("#"+t).animate({height:"-="+amountToChange+"px",width:"-="+amountToChange+"px"},{duration:zoomInOutSpeed}),countZoomOut++)}}function decisionYesNo(e){var t=(new Date-startTimeImageExamination)/1e3,a=$("#imageDiv").find("img");if(a.length>0){var n=a.first().attr("id"),o=n.substring("carImage".length,n.length);$("#imageId"+o).val(o),$("#durationToAnswer"+o).val(t),$("#answer"+o).val(e),$("#countZoomIn"+o).val(countZoomIn),$("#countZoomOut"+o).val(countZoomOut);var i={imageId:o,countZoomIn:countZoomIn,countZoomOut:countZoomOut,answer:e,durationToAnswer:t,responseDate:new Date};if(results.push(i),countZoomIn=0,countZoomOut=0,resetVehicleIdentificationDiv(),$("#imageTile"+o).fadeTo("slow",.44),$("#imageTile"+o).append('<div class="disabledImageTile"></div>'),$.ajax({url:"/checkImage/",type:"POST",data:{answer:e,imageId:o},success:function(e){if($("#correctness"+o).css("display","block"),"Correct"==e)$("#correctness"+o).append('<i class="icon-ok-sign text-success"></i>'),numberOfCorrectManual++,new Audio(static_url+"sound/correct.wav").play();else if("Incorrect"==e){$("#correctness"+o).append('<i class="icon-remove-sign text-danger"></i>'),numberOfIncorrectManual++,new Audio(static_url+"sound/bad-beep-incorrect.mp3").play()}var t=Number(numberOfCorrectManual)+Number(numberOfIncorrectManual);$("#manualAccScore").html("Accuracy: "+Number(numberOfCorrectManual)+"/"+t),$("#manualAccScore").fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)},error:function(e,t,a){}}),++countCompletedImages==numImgToManual){finishTimeManual=(new Date-startTimePage)/1e3;var r=(new Date-startTimePage)/1e3;automationDone?sendData(r):automationDone||$("#imageDiv2").html("<h2>You need to wait for the automation to finish its job! </h2>")}}}function nextTrial(){return countCompletedImages<numImgToManual?(alert("You did not complete all of the "+numImgToManual+" images! Please complete all the images, and then submit your answers!"),!1):automationDone?(sendData((new Date-startTimePage)/1e3),!0):(alert("You need to wait for the automation to finish its job!"),!1)}function sendData(e){var t={results:results,numImgToAuto:numImgToAuto,numImgToManual:numImgToManual,finishTimeManual:finishTimeManual,pageDuration:e};$('#ImageInputForm [name="Data"]').val(JSON.stringify(t)),$("#ImageInputForm").submit()}function resetVehicleIdentificationDiv(){document.getElementById("vehicleIdentificationPlaceHolder").style.display="block",document.getElementById("vehicleIdentification").style.display="none"}function displayVehicleIdentificationDiv(){document.getElementById("vehicleIdentification").style.display="block",document.getElementById("vehicleIdentificationPlaceHolder").style.display="none"}function viewImage(e){var t=e.substring("img".length,e.length);displayVehicleIdentificationDiv(),$("#imageDiv").html('<img id="carImage'+t+'" src='+static_url+"images/car"+t+'.jpg class="mx-auto d-block" width="100" height="100" >'),startTimeImageExamination=new Date}$(document).ready(function(){startTimePage=new Date,0==numImgToManual?($("#imageDiv2").html("<h2>You need to wait for the automation to finish its job! </h2>"),finishTimeManual=0):finishTimeManual=new Date;$("#timer").runner({autostart:!0,countdown:!0,startAt:12e4,stopAt:0}).on("runnerFinish",function(e,t){finishTimeManual=(new Date-startTimePage)/1e3;var a=(new Date-startTimePage)/1e3;if(0==countCompletedImages&&numImgToManual>0)return alert("Please examine the manual images"),location.reload(),!1;alert("Time is up!"),sendData(a)}),$(window).resize(function(){Math.round(100*window.devicePixelRatio)});var e=[61,107,173,109,187,189];$(document).keydown(function(t){1==t.ctrlKey&&-1!=e.indexOf(t.which)&&t.preventDefault()}),$(window).bind("mousewheel DOMMouseScroll",function(e){1==e.ctrlKey&&e.preventDefault()}),populateImages(numImgToManual,numImgToAuto,round),0==numImgToAuto&&(automationDone=!0);var t=110,a=setInterval(function(){t<1?(clearInterval(a),new Audio(static_url+"sound/10-sec-countdown.wav").play()):t--},1e3)});var angle=0;function rotate(){var e=$("#imageDiv").find("img").first().attr("id"),t=e.substring("carImage".length,e.length);angle=(angle+90)%360,$("#carImage"+t).css("transform","rotate("+angle+"deg)")}function createImgInputData(e){for(var t=1;t<=e;t++)$("#decisionDiv").append(creteInputObj("imageId"+t,"")),$("#decisionDiv").append(creteInputObj("answer"+t,""))}function createImageInputData(e,t){for(var a=1;a<=e;a++)$("#ImageInputForm").append(creteInputObj("roundNumber"+a,t)),$("#ImageInputForm").append(creteInputObj("imageId"+a,"")),$("#ImageInputForm").append(creteInputObj("countZoomIn"+a,"")),$("#ImageInputForm").append(creteInputObj("countZoomOut"+a,"")),$("#ImageInputForm").append(creteInputObj("answer"+a,"")),$("#ImageInputForm").append(creteInputObj("durationToAnswer"+a,""))}function creteInputObj(e,t){var a=document.createElement("input");return a.setAttribute("type","hidden"),a.setAttribute("id",e),a.setAttribute("value",t),a}$("#manualImageTiles, #imageDiv").on("contextmenu","img",function(e){return!1});